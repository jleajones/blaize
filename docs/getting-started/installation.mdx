# ðŸ“¦ Installation

> Choose the setup method that fits your workflow

---

## Prerequisites

Before installing BlaizeJS, ensure you have:

| Requirement | Minimum Version | Check Command |
|-------------|-----------------|---------------|
| **Node.js** | 23.0.0+ | `node --version` |
| **Package Manager** | npm 10+, pnpm 9+, yarn 4+, or bun 1+ | `npm --version` / `pnpm --version` |

> **Why Node.js 23?** BlaizeJS uses modern Node.js features like native fetch, AsyncLocalStorage improvements, and ESM-first module resolution. Node 23+ provides the best experience.

---

## Option 1: Create BlaizeJS App (recommended)

The fastest way to start a new BlaizeJS project:

```bash
npx create-blaize-app my-api
cd my-api
npm run dev
```

This gives you:
- âœ… Pre-configured TypeScript
- âœ… File-based routing structure
- âœ… Development server with hot reload
- âœ… HTTP/2 with auto-generated HTTPS certificates
- âœ… Example routes with tests
- âœ… Type-safe route factory pattern

<details>
<summary>Using a different package manager?</summary>

```bash
# pnpm (recommended for monorepos)
pnpm create blaize-app my-api

# yarn
yarn create blaize-app my-api

# bun
bun create blaize-app my-api
```

</details>

### Choose your template

BlaizeJS offers two templates to match your needs:

#### ðŸŽ¯ Minimal (default)

Perfect for learning BlaizeJS or starting a new project:

```bash
npx create-blaize-app my-api
# or explicitly:
npx create-blaize-app my-api --template minimal
```

**Includes:**
- File-based routing
- Type-safe file uploads with Zod schemas
- Server-Sent Events (SSE) for real-time updates
- EventBus for publish/subscribe patterns
- Comprehensive test suite (30 tests, 80%+ coverage)

**Project structure:**

```
my-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts              # Server setup
â”‚   â”œâ”€â”€ app-router.ts       # Type-safe route factory
â”‚   â”œâ”€â”€ app-type.ts         # Route registry for client
â”‚   â”œâ”€â”€ events.ts           # Event schemas
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ index.ts        # GET /
â”‚       â”œâ”€â”€ health.ts       # GET /health
â”‚       â”œâ”€â”€ upload.ts       # POST /upload (file uploads)
â”‚       â”œâ”€â”€ users/
â”‚       â”‚   â”œâ”€â”€ index.ts    # GET /users
â”‚       â”‚   â””â”€â”€ [userId]/
â”‚       â”‚       â””â”€â”€ index.ts # GET /users/:userId
â”‚       â””â”€â”€ events/
â”‚           â””â”€â”€ stream.ts   # GET /events/stream (SSE)
â””â”€â”€ __tests__/              # Test suite
```

**Available endpoints:**
- `GET /` â€” Welcome message
- `GET /health` â€” Health check
- `GET /users` â€” List users
- `GET /users/:userId` â€” Get user by ID
- `POST /upload` â€” File upload with validation
- `GET /events/stream` â€” SSE streaming

---

#### ðŸš€ Advanced

Production-ready template with Redis-powered plugins:

```bash
npx create-blaize-app my-api --template advanced
```

**Includes everything in Minimal, plus:**
- **Queue Plugin** â€” Background job processing with Redis
- **Cache Plugin** â€” High-performance caching with Redis
- **Metrics Plugin** â€” Prometheus-compatible metrics
- **Docker Compose** â€” Redis + Redis Commander (optional GUI)
- **Integration tests** â€” Full test coverage with Redis

**Additional requirements:**
- Docker (for Redis)

**Project structure:**

```
my-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts            # Server entry point
â”‚   â”œâ”€â”€ config.ts           # Configuration (Redis, etc.)
â”‚   â”œâ”€â”€ events.ts           # Event schemas
â”‚   â”œâ”€â”€ handlers.ts         # Queue job handlers
â”‚   â”œâ”€â”€ app-router.ts       # Route factory
â”‚   â”œâ”€â”€ app-type.ts         # Type exports
â”‚   â”œâ”€â”€ routes/             # API routes
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ health/         # Health checks
â”‚   â”‚   â”œâ”€â”€ metrics/        # Prometheus metrics
â”‚   â”‚   â”œâ”€â”€ queue/          # Queue management
â”‚   â”‚   â”œâ”€â”€ cache/          # Cache operations
â”‚   â”‚   â””â”€â”€ user/           # User management
â”‚   â””â”€â”€ data/               # Mock data
â”œâ”€â”€ docker-compose.yml      # Redis services
â”œâ”€â”€ .env.example            # Environment template
â””â”€â”€ __tests__/
    â”œâ”€â”€ routes/             # Unit tests
    â””â”€â”€ integration/        # Integration tests
```

**Additional endpoints:**
- `GET /cache/dashboard` â€” Cache statistics dashboard
- `GET /queue/stats` â€” Queue statistics
- `GET /metrics` â€” Prometheus metrics
- `GET /metrics/dashboard` â€” Metrics dashboard

**Quick start (advanced template):**

```bash
# 1. Create project
npx create-blaize-app my-api --template advanced
cd my-api

# 2. Start Redis
docker compose up -d

# 3. Start server
npm run dev

# 4. Visit https://localhost:7485
```

---

### CLI options

```bash
create-blaize-app <project-name> [options]
```

| Option | Description | Default |
|--------|-------------|---------|
| `--template <n>` | Template: `minimal` or `advanced` | `minimal` |
| `--pm <manager>` | Package manager (npm, pnpm, yarn, bun) | Auto-detected |
| `--no-git` | Skip git initialization | `false` |
| `--no-install` | Skip dependency installation | `false` |
| `--latest` | Use latest package versions | `false` |
| `--dry-run` | Preview without creating files | `false` |
| `--help, -h` | Show help message | â€” |
| `--version, -v` | Show version number | â€” |

**Examples:**

```bash
# Create with pnpm
npx create-blaize-app my-api --pm pnpm

# Advanced template with yarn
npx create-blaize-app my-api --template advanced --pm yarn

# Preview without creating files
npx create-blaize-app my-api --dry-run

# Skip git init (useful in existing repos)
npx create-blaize-app my-api --no-git

# Skip installation, install manually later
npx create-blaize-app my-api --no-install
```

---

## Option 2: Manual installation

For adding BlaizeJS to an existing project or when you want full control over your setup.

### Step 1: Install dependencies

**Runtime dependencies:**

```bash
npm install blaizejs zod
```

| Package | Purpose |
|---------|---------|
| `blaizejs` | Core framework |
| `zod` | Schema validation (required for type inference) |

**Development dependencies:**

```bash
npm install -D typescript tsx @types/node
```

| Package | Purpose |
|---------|---------|
| `typescript` | TypeScript compiler |
| `tsx` | Development server with hot reload |
| `@types/node` | Node.js type definitions |

### Step 2: Configure TypeScript

Create `tsconfig.json`:

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "lib": ["ES2022"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

**Key settings explained:**

| Setting | Why It Matters |
|---------|----------------|
| `"module": "NodeNext"` | Required for ESM support |
| `"strict": true` | Enables full type safety |
| `"target": "ES2022"` | Modern JavaScript features |

### Step 3: Configure package.json

Add these fields to your `package.json`:

```json
{
  "type": "module",
  "scripts": {
    "dev": "tsx --watch src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js",
    "type-check": "tsc --noEmit"
  }
}
```

> **Important:** `"type": "module"` is required for ESM imports.

### Step 4: Create project structure

```bash
mkdir -p src/routes
```

Create `src/app-router.ts`:

```typescript
import { Blaize, type InferContext } from 'blaizejs';

// Type-only server for type inference
const typeServer = Blaize.createServer({
  host: 'localhost',
  port: 7485,
  routesDir: './src/routes',
});

type AppContext = InferContext<typeof typeServer>;

export const route = Blaize.Router.createRouteFactory<
  AppContext['state'],
  AppContext['services']
>();
```

Create `src/app.ts`:

```typescript
import { Blaize } from 'blaizejs';
import { fileURLToPath } from 'node:url';
import path from 'node:path';

// ESM path resolution
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Create server
const server = Blaize.createServer({
  host: 'localhost',
  port: 7485,
  routesDir: path.resolve(__dirname, './routes'),
  http2: { enabled: true },
});

// Start server
await server.listen();
console.log(`ðŸš€ Server running at https://localhost:7485`);
```

Create `src/routes/index.ts`:

```typescript
import { route } from '../app-router';
import { z } from 'zod';

export const getRoot = route.get({
  schema: {
    response: z.object({
      message: z.string(),
      timestamp: z.string(),
    }),
  },
  handler: async () => ({
    message: 'Hello from BlaizeJS!',
    timestamp: new Date().toISOString(),
  }),
});
```

**Important:** Note the handler signature uses destructuring `({ ctx, params, logger, eventBus })`:

```typescript
// âœ… Correct (new signature)
handler: async ({ ctx, params, logger, eventBus }) => {
  logger.info('Processing request');
  return { message: 'Hello!' };
}

// âŒ Old signature (deprecated)
handler: async (ctx, params, logger) => {
  // This still works but is deprecated
  return { message: 'Hello!' };
}
```

### Step 5: Run your server

```bash
npm run dev
```

Visit `https://localhost:7485` (accept the self-signed certificate warning).

---

## Additional packages

### Type-safe client

For calling your API with full type inference:

```bash
npm install @blaizejs/client
```

Create `src/app-type.ts`:

```typescript
import { getRoot } from './routes/index';

export const routes = {
  getRoot,
} as const;
```

Use in client:

```typescript
import bc from '@blaizejs/client';
import { routes } from './server/app-type';

const client = bc.create('https://localhost:7485', routes);
const data = await client.$get.getRoot();
console.log(data.message); // TypeScript knows this is a string
```

### Testing utilities

For testing your routes and middleware:

```bash
npm install -D @blaizejs/testing-utils vitest
```

```typescript
import { createTestContext } from '@blaizejs/testing-utils';
import { describe, it, expect } from 'vitest';
import { getRoot } from '../routes/index';

describe('GET /', () => {
  it('returns greeting', async () => {
    const ctx = createTestContext({ method: 'GET' });
    const result = await getRoot.handler({ ctx, params: {}, logger: ctx.logger, eventBus: ctx.eventBus });
    expect(result.message).toBe('Hello from BlaizeJS!');
  });
});
```

### Official plugins

| Package | Purpose | Install |
|---------|---------|---------|
| `@blaizejs/plugin-queue` | Background job processing | `npm install @blaizejs/plugin-queue` |
| `@blaizejs/plugin-cache` | Caching (memory/Redis) | `npm install @blaizejs/plugin-cache` |
| `@blaizejs/plugin-metrics` | Prometheus metrics | `npm install @blaizejs/plugin-metrics` |

### Redis adapter

For Redis-backed EventBus, Queue, and Cache:

```bash
npm install @blaizejs/adapter-redis
```

### Official middleware

| Package | Purpose | Install |
|---------|---------|---------|
| `@blaizejs/middleware-security` | Security headers (CSP, HSTS, etc.) | `npm install @blaizejs/middleware-security` |

---

## Environment configuration

BlaizeJS reads these environment variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Server port | `7485` |
| `HOST` | Server host | `localhost` |
| `NODE_ENV` | Environment mode | `development` |

```bash
# .env
PORT=8080
HOST=0.0.0.0
NODE_ENV=production
```

```typescript
// src/app.ts
const server = Blaize.createServer({
  port: process.env.PORT ? parseInt(process.env.PORT) : 7485,
  host: process.env.HOST || 'localhost',
  // ...
});
```

> **Note:** The `tsx` dev server automatically loads `.env` files â€” no additional configuration needed!

---

## Verification

After installation, verify everything works:

```bash
# Start dev server
npm run dev

# In another terminal, test the API
curl -k https://localhost:7485/
```

Expected response:

```json
{
  "message": "Hello from BlaizeJS!",
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

---

## Troubleshooting

### "Cannot find module" errors

Ensure `"type": "module"` is in your `package.json` and you're using `.js` extensions in imports if needed (TypeScript handles `.ts` automatically).

### TypeScript errors about ESM

Make sure `tsconfig.json` has:
```json
{
  "compilerOptions": {
    "module": "NodeNext",
    "moduleResolution": "NodeNext"
  }
}
```

### Certificate warnings in browser

BlaizeJS uses HTTPS by default with a self-signed certificate in development. This is expected â€” click through the warning or use `curl -k`.

To disable HTTPS in development:
```typescript
const server = Blaize.createServer({
  http2: { enabled: false }, // Disable HTTP/2 (uses HTTP/1.1)
  // ...
});
```

### Port already in use

Change the port in your server configuration:
```typescript
const server = Blaize.createServer({
  port: 3000, // Use a different port
  // ...
});
```

### Handler signature errors

If you see TypeScript errors about handler parameters, you're likely using the old signature. Update to use destructuring:

```typescript
// âŒ Old (deprecated)
handler: async (ctx, params, logger) => { ... }

// âœ… New (correct)
handler: async ({ ctx, params, logger, eventBus }) => { ... }
```

### Advanced template: Redis connection errors

If using the advanced template and seeing Redis errors:

1. Make sure Docker is running
2. Start Redis: `docker compose up -d`
3. Verify Redis is running: `docker compose ps`
4. Test connection: `redis-cli ping` (should return `PONG`)

---

## Next steps

- **[Quick start](./quick-start)** â€” Build your first routes
- **[Tutorial](./tutorial)** â€” Complete API walkthrough  
- **[Architecture](../architecture/overview)** â€” Understand how BlaizeJS works
- **[File-based routing](../guides/routing)** â€” Deep dive into routing patterns